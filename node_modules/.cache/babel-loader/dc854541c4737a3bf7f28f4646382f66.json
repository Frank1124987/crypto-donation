{"remainingRequest":"/Users/weifan4569908/Documents/Crypto_Donation/crypto-donate/node_modules/babel-loader/lib/index.js!/Users/weifan4569908/Documents/Crypto_Donation/crypto-donate/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/weifan4569908/Documents/Crypto_Donation/crypto-donate/node_modules/vue-loader-v16/dist/index.js??ref--0-1!/Users/weifan4569908/Documents/Crypto_Donation/crypto-donate/src/components/nft/RegisterNFT.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/weifan4569908/Documents/Crypto_Donation/crypto-donate/src/components/nft/RegisterNFT.vue","mtime":1642503172334},{"path":"/Users/weifan4569908/Documents/Crypto_Donation/crypto-donate/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/weifan4569908/Documents/Crypto_Donation/crypto-donate/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/weifan4569908/Documents/Crypto_Donation/crypto-donate/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/weifan4569908/Documents/Crypto_Donation/crypto-donate/node_modules/vue-loader-v16/dist/index.js","mtime":1628298225000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9Vc2Vycy93ZWlmYW40NTY5OTA4L0RvY3VtZW50cy9DcnlwdG9fRG9uYXRpb24vY3J5cHRvLWRvbmF0ZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIjsKaW1wb3J0IHsgcmVmLCBjb21wdXRlZCB9IGZyb20gJ3Z1ZSc7CmltcG9ydCB7IHVzZVN0b3JlIH0gZnJvbSAndnVleCc7CmltcG9ydCB7IHVzZVJvdXRlLCB1c2VSb3V0ZXIgfSBmcm9tICd2dWUtcm91dGVyJzsKaW1wb3J0IHsgd2ViMywgY29udHJhY3QgfSBmcm9tICdAL2NvbnRyYWN0L2NvbnRyYWN0LmpzJzsKaW1wb3J0IHsgTkZUU3RvcmFnZSwgRmlsZSB9IGZyb20gJ25mdC5zdG9yYWdlJzsgLy8gaW1wb3J0IHtwYWNrfSBmcm9tICdpcGZzLWNhci9wYWNrJwoKaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnOwpleHBvcnQgZGVmYXVsdCB7CiAgcHJvcHM6IHsKICAgIHBsYW5zOiB7CiAgICAgIHR5cGU6IE9iamVjdAogICAgfQogIH0sCiAgc2V0dXA6IGZ1bmN0aW9uIHNldHVwKHByb3BzKSB7CiAgICB2YXIgcm91dGUgPSB1c2VSb3V0ZSgpOwogICAgdmFyIG5hbWUgPSByZWYoIiIpOwogICAgdmFyIGRlc2NyaXB0aW9uID0gcmVmKCIiKTsKICAgIHZhciBpbWFnZSA9IHJlZigiIik7CiAgICB2YXIgc2VsZWN0ZWRQbGFuID0gcmVmKCIiKTsKICAgIHZhciBwbGFucyA9IHJlZihwcm9wcy5wbGFucyk7CiAgICB2YXIgaW1hZ2VfdGVtcCA9IG51bGw7CgogICAgdmFyIHBpY2tGaWxlID0gZnVuY3Rpb24gcGlja0ZpbGUoZXZlbnQpIHsKICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CgogICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBpbWFnZS52YWx1ZSA9IGUudGFyZ2V0LnJlc3VsdDsKICAgICAgfTsKCiAgICAgIGltYWdlX3RlbXAgPSBldmVudC50YXJnZXQuZmlsZXNbMF07CiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGV2ZW50LnRhcmdldC5maWxlc1swXSk7CiAgICB9OwoKICAgIHZhciByZWdpc3Rlck5GVCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVmID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHZhciBhcGlLZXksIGNsaWVudCwgbWV0YWRhdGEsIGFkZHJlc3M7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYXBpS2V5ID0gJ2V5SmhiR2NpT2lKSVV6STFOaUlzSW5SNWNDSTZJa3BYVkNKOS5leUp6ZFdJaU9pSmthV1E2WlhSb2Nqb3dlRFkwUTJOR05FVmxNRU00TjJJMlFqWmxORUZEUlRSRlFXUmlOemcwTUdRMFJqVXlNak14TVRjaUxDSnBjM01pT2lKdVpuUXRjM1J2Y21GblpTSXNJbWxoZENJNk1UWXpPVFUwTkRReU5UZ3dOQ3dpYm1GdFpTSTZJbU55ZVhCMFgyUnZibUYwYVc5dUluMC5pR2g5bTI3LURuY09FZk1sMHZCRXk4ZlBXSUtZMzJlZVFMa21hdGZhd2JJJzsKICAgICAgICAgICAgICAgIGNsaWVudCA9IG5ldyBORlRTdG9yYWdlKHsKICAgICAgICAgICAgICAgICAgdG9rZW46IGFwaUtleQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIHJldHVybiBjbGllbnQuc3RvcmUoewogICAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLnZhbHVlLAogICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24udmFsdWUsCiAgICAgICAgICAgICAgICAgIGltYWdlOiBpbWFnZV90ZW1wCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgbWV0YWRhdGEgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDc7CiAgICAgICAgICAgICAgICByZXR1cm4gd2ViMy5ldGguZ2V0QWNjb3VudHMoKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgYWRkcmVzcyA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgICAgICBjb250cmFjdC5tZXRob2RzLnJlZ2lzdGVyX25mdChyb3V0ZS5wYXJhbXMuZGVwYXJ0bWVudElkLCBuYW1lLnZhbHVlLCBtZXRhZGF0YS51cmwpLnNlbmQoewogICAgICAgICAgICAgICAgICBmcm9tOiBhZGRyZXNzWzBdLAogICAgICAgICAgICAgICAgICBnYXM6IDkxODc1MDAKICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICBjb250cmFjdC5tZXRob2RzLmFkZE5GVFRvUGxhbihyb3V0ZS5wYXJhbXMuZGVwYXJ0bWVudElkLCBzZWxlY3RlZFBsYW4udmFsdWUsIG5hbWUudmFsdWUpLnNlbmQoewogICAgICAgICAgICAgICAgICAgIGZyb206IGFkZHJlc3NbMF0sCiAgICAgICAgICAgICAgICAgICAgZ2FzOiA5MTg3NTAwCiAgICAgICAgICAgICAgICAgIH0pLnRoZW4oY29uc29sZS5sb2cpLmNhdGNoKGNvbnNvbGUubG9nKTsKICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coImVycm9yOiAiLCBlcnIpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUpOwogICAgICB9KSk7CgogICAgICByZXR1cm4gZnVuY3Rpb24gcmVnaXN0ZXJORlQoKSB7CiAgICAgICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfTsKICAgIH0oKTsKCiAgICByZXR1cm4gewogICAgICBuYW1lOiBuYW1lLAogICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24sCiAgICAgIGltYWdlOiBpbWFnZSwKICAgICAgcGxhbnM6IHBsYW5zLAogICAgICBzZWxlY3RlZFBsYW46IHNlbGVjdGVkUGxhbiwKICAgICAgcGlja0ZpbGU6IHBpY2tGaWxlLAogICAgICByZWdpc3Rlck5GVDogcmVnaXN0ZXJORlQKICAgIH07CiAgfQp9Ow=="},{"version":3,"sources":["/Users/weifan4569908/Documents/Crypto_Donation/crypto-donate/src/components/nft/RegisterNFT.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n    <div>\n        <form @submit.prevent=\"registerNFT\">\n            <div>\n                <label for=\"name\">NFT名稱：</label>\n                <br>\n                <input id=\"name\" type=\"text\" v-model=\"name\" >\n            </div>\n            <div>\n                <label for=\"description\">描述：</label>\n                <br>\n                <input id=\"description\" type=\"text\" v-model=\"description\">\n            </div>\n            <br>\n            <div>\n                <span>選擇掛鉤的專案：</span>\n                <select v-model=\"selectedPlan\">\n                    <option v-for=\"(plan, id) in plans\" :key=id>\n                        {{plan.name}}\n                    </option>\n                </select>\n            </div>\n            <br>\n            <div>\n                <label for=\"formFile\" class=\"form-label\">Upload Image：</label>\n                <input class=\"form-control\" type=\"file\" @input=\"pickFile\" accept=\"image/*\">\n                <img class=\"preview-img\" :src=\"image\" alt=\"\">\n            </div>\n            <br>\n            <input type=\"submit\" value=\"提交\">\n        </form>\n    </div>\n</template>\n\n<script>\nimport {ref, computed} from 'vue'\nimport {useStore} from 'vuex'\nimport {useRoute, useRouter} from 'vue-router'\nimport {web3, contract} from '@/contract/contract.js'\nimport {NFTStorage, File} from 'nft.storage'\n// import {pack} from 'ipfs-car/pack'\nimport * as fs from 'fs'\n\nexport default {\n    props: {\n        plans: {\n            type: Object\n        }\n    },\n    setup(props){\n        const route = useRoute()\n\n        const name = ref(\"\");\n        const description = ref(\"\");\n        const image = ref(\"\");\n        const selectedPlan = ref(\"\")\n\n        const plans = ref(props.plans)\n\n        let image_temp = null\n        const pickFile = (event) => {\n            const reader = new FileReader()\n            reader.onload = (e) => {\n                image.value = e.target.result;\n            }\n\n            image_temp = event.target.files[0]\n            reader.readAsDataURL(event.target.files[0])\n        }\n\n        const registerNFT = async () => {\n            const apiKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJkaWQ6ZXRocjoweDY0Q2NGNEVlMEM4N2I2QjZlNEFDRTRFQWRiNzg0MGQ0RjUyMjMxMTciLCJpc3MiOiJuZnQtc3RvcmFnZSIsImlhdCI6MTYzOTU0NDQyNTgwNCwibmFtZSI6ImNyeXB0X2RvbmF0aW9uIn0.iGh9m27-DncOEfMl0vBEy8fPWIKY32eeQLkmatfawbI'\n            const client = new NFTStorage({token : apiKey})\n            const metadata = await client.store({\n                name: name.value,\n                description: description.value,\n                image: image_temp\n            })\n            const address = await web3.eth.getAccounts()\n\n            contract.methods.register_nft(route.params.departmentId, name.value, metadata.url).send({\n                from: address[0],\n                gas : 9187500,\n            }).then(() => {\n                contract.methods.addNFTToPlan(route.params.departmentId, selectedPlan.value, name.value).send({\n                    from: address[0],\n                    gas : 9187500,      \n                }).then(console.log)\n                .catch(console.log)\n            }).catch(err => {\n                console.log(\"error: \", err)\n            })\n        }\n\n\n        return {\n            name,\n            description,\n            image,\n            plans,\n            selectedPlan,\n            pickFile,\n            registerNFT\n        }\n    }\n}\n</script>\n\n<style scoped>\n.imagePreviewWrapper {\n  background-repeat: no-repeat;\n    width: 250px;\n    height: 250px;\n    display: block;\n    cursor: pointer;\n    margin: 0 auto 30px;\n    background-size: contain;\n    background-position: center center;\n}\n\n.preview-img {\n    width: 50%;\n}\n</style>"],"sourceRoot":""}]}