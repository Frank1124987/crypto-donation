{"remainingRequest":"C:\\Users\\G501VW\\Desktop\\0817\\crypto-donation\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\G501VW\\Desktop\\0817\\crypto-donation\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\G501VW\\Desktop\\0817\\crypto-donation\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader-v16\\dist\\index.js??ref--0-1!C:\\Users\\G501VW\\Desktop\\0817\\crypto-donation\\src\\components\\nft\\RegisterNFT.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\G501VW\\Desktop\\0817\\crypto-donation\\src\\components\\nft\\RegisterNFT.vue","mtime":1640104029002},{"path":"C:\\Users\\G501VW\\Desktop\\0817\\crypto-donation\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\G501VW\\Desktop\\0817\\crypto-donation\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\G501VW\\Desktop\\0817\\crypto-donation\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\G501VW\\Desktop\\0817\\crypto-donation\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkM6L1VzZXJzL0c1MDFWVy9EZXNrdG9wLzA4MTcvY3J5cHRvLWRvbmF0aW9uL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwppbXBvcnQgeyByZWYsIGNvbXB1dGVkIH0gZnJvbSAndnVlJzsKaW1wb3J0IHsgdXNlU3RvcmUgfSBmcm9tICd2dWV4JzsKaW1wb3J0IHsgdXNlUm91dGUsIHVzZVJvdXRlciB9IGZyb20gJ3Z1ZS1yb3V0ZXInOwppbXBvcnQgeyB3ZWIzLCBjb250cmFjdCB9IGZyb20gJ0AvY29udHJhY3QvY29udHJhY3QuanMnOwppbXBvcnQgeyBORlRTdG9yYWdlLCBGaWxlIH0gZnJvbSAnbmZ0LnN0b3JhZ2UnOyAvLyBpbXBvcnQge3BhY2t9IGZyb20gJ2lwZnMtY2FyL3BhY2snCgppbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7CmV4cG9ydCBkZWZhdWx0IHsKICBwcm9wczogewogICAgcGxhbnM6IHsKICAgICAgdHlwZTogT2JqZWN0CiAgICB9CiAgfSwKICBzZXR1cDogZnVuY3Rpb24gc2V0dXAocHJvcHMpIHsKICAgIHZhciByb3V0ZSA9IHVzZVJvdXRlKCk7CiAgICB2YXIgbmFtZSA9IHJlZigiIik7CiAgICB2YXIgZGVzY3JpcHRpb24gPSByZWYoIiIpOwogICAgdmFyIGltYWdlID0gcmVmKCIiKTsKICAgIHZhciBzZWxlY3RlZFBsYW4gPSByZWYoIiIpOwogICAgdmFyIHBsYW5zID0gcmVmKHByb3BzLnBsYW5zKTsKICAgIHZhciBpbWFnZV90ZW1wID0gbnVsbDsKCiAgICB2YXIgcGlja0ZpbGUgPSBmdW5jdGlvbiBwaWNrRmlsZShldmVudCkgewogICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKCiAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIGltYWdlLnZhbHVlID0gZS50YXJnZXQucmVzdWx0OwogICAgICB9OwoKICAgICAgaW1hZ2VfdGVtcCA9IGV2ZW50LnRhcmdldC5maWxlc1swXTsKICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZXZlbnQudGFyZ2V0LmZpbGVzWzBdKTsKICAgIH07CgogICAgdmFyIHJlZ2lzdGVyTkZUID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgdmFyIF9yZWYgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIGFwaUtleSwgY2xpZW50LCBtZXRhZGF0YSwgYWRkcmVzczsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhcGlLZXkgPSAnZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnpkV0lpT2lKa2FXUTZaWFJvY2pvd2VEWTBRMk5HTkVWbE1FTTROMkkyUWpabE5FRkRSVFJGUVdSaU56ZzBNR1EwUmpVeU1qTXhNVGNpTENKcGMzTWlPaUp1Wm5RdGMzUnZjbUZuWlNJc0ltbGhkQ0k2TVRZek9UVTBORFF5TlRnd05Dd2libUZ0WlNJNkltTnllWEIwWDJSdmJtRjBhVzl1SW4wLmlHaDltMjctRG5jT0VmTWwwdkJFeThmUFdJS1kzMmVlUUxrbWF0ZmF3YkknOwogICAgICAgICAgICAgICAgY2xpZW50ID0gbmV3IE5GVFN0b3JhZ2UoewogICAgICAgICAgICAgICAgICB0b2tlbjogYXBpS2V5CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgcmV0dXJuIGNsaWVudC5zdG9yZSh7CiAgICAgICAgICAgICAgICAgIG5hbWU6IG5hbWUudmFsdWUsCiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbi52YWx1ZSwKICAgICAgICAgICAgICAgICAgaW1hZ2U6IGltYWdlX3RlbXAKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBtZXRhZGF0YSA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIHJldHVybiB3ZWIzLmV0aC5nZXRBY2NvdW50cygpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBhZGRyZXNzID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgIGNvbnRyYWN0Lm1ldGhvZHMucmVnaXN0ZXJfbmZ0KHJvdXRlLnBhcmFtcy5kZXBhcnRtZW50SWQsIG5hbWUudmFsdWUsIG1ldGFkYXRhLnVybCkuc2VuZCh7CiAgICAgICAgICAgICAgICAgIGZyb206IGFkZHJlc3NbMF0sCiAgICAgICAgICAgICAgICAgIGdhczogOTE4NzUwMAogICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIGNvbnRyYWN0Lm1ldGhvZHMuYWRkTkZUVG9QbGFuKHJvdXRlLnBhcmFtcy5kZXBhcnRtZW50SWQsIHNlbGVjdGVkUGxhbi52YWx1ZSwgbmFtZS52YWx1ZSkuc2VuZCh7CiAgICAgICAgICAgICAgICAgICAgZnJvbTogYWRkcmVzc1swXSwKICAgICAgICAgICAgICAgICAgICBnYXM6IDkxODc1MDAKICAgICAgICAgICAgICAgICAgfSkudGhlbihjb25zb2xlLmxvZykuY2F0Y2goY29uc29sZS5sb2cpOwogICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZXJyb3I6ICIsIGVycik7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgIH0pKTsKCiAgICAgIHJldHVybiBmdW5jdGlvbiByZWdpc3Rlck5GVCgpIHsKICAgICAgICByZXR1cm4gX3JlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSgpOwoKICAgIHJldHVybiB7CiAgICAgIG5hbWU6IG5hbWUsCiAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiwKICAgICAgaW1hZ2U6IGltYWdlLAogICAgICBwbGFuczogcGxhbnMsCiAgICAgIHNlbGVjdGVkUGxhbjogc2VsZWN0ZWRQbGFuLAogICAgICBwaWNrRmlsZTogcGlja0ZpbGUsCiAgICAgIHJlZ2lzdGVyTkZUOiByZWdpc3Rlck5GVAogICAgfTsKICB9Cn07"},{"version":3,"sources":["C:\\Users\\G501VW\\Desktop\\0817\\crypto-donation\\src\\components\\nft\\RegisterNFT.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n    <div>\r\n        <form @submit.prevent=\"registerNFT\">\r\n            <div>\r\n                <label for=\"name\">NFT名稱：</label>\r\n                <br>\r\n                <input id=\"name\" type=\"text\" v-model=\"name\" >\r\n            </div>\r\n            <div>\r\n                <label for=\"description\">描述：</label>\r\n                <br>\r\n                <input id=\"description\" type=\"text\" v-model=\"description\">\r\n            </div>\r\n            <br>\r\n            <div>\r\n                <span>選擇掛鉤的專案：</span>\r\n                <select v-model=\"selectedPlan\">\r\n                    <option v-for=\"(plan, id) in plans\" :key=id>\r\n                        {{plan.name}}\r\n                    </option>\r\n                </select>\r\n            </div>\r\n            <br>\r\n            <div>\r\n                <label for=\"formFile\" class=\"form-label\">Upload Image：</label>\r\n                <input class=\"form-control\" type=\"file\" @input=\"pickFile\" accept=\"image/*\">\r\n                <img id=\"nft-preview-img\" :src=\"image\" alt=\"\">\r\n            </div>\r\n            <br>\r\n            <input type=\"submit\" value=\"提交\">\r\n        </form>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport {ref, computed} from 'vue'\r\nimport {useStore} from 'vuex'\r\nimport {useRoute, useRouter} from 'vue-router'\r\nimport {web3, contract} from '@/contract/contract.js'\r\nimport {NFTStorage, File} from 'nft.storage'\r\n// import {pack} from 'ipfs-car/pack'\r\nimport * as fs from 'fs'\r\n\r\nexport default {\r\n    props: {\r\n        plans: {\r\n            type: Object\r\n        }\r\n    },\r\n    setup(props){\r\n        const route = useRoute()\r\n\r\n        const name = ref(\"\");\r\n        const description = ref(\"\");\r\n        const image = ref(\"\");\r\n        const selectedPlan = ref(\"\")\r\n\r\n        const plans = ref(props.plans)\r\n\r\n        let image_temp = null\r\n        const pickFile = (event) => {\r\n            const reader = new FileReader()\r\n            reader.onload = (e) => {\r\n                image.value = e.target.result;\r\n            }\r\n\r\n            image_temp = event.target.files[0]\r\n            reader.readAsDataURL(event.target.files[0])\r\n        }\r\n\r\n        const registerNFT = async () => {\r\n            const apiKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJkaWQ6ZXRocjoweDY0Q2NGNEVlMEM4N2I2QjZlNEFDRTRFQWRiNzg0MGQ0RjUyMjMxMTciLCJpc3MiOiJuZnQtc3RvcmFnZSIsImlhdCI6MTYzOTU0NDQyNTgwNCwibmFtZSI6ImNyeXB0X2RvbmF0aW9uIn0.iGh9m27-DncOEfMl0vBEy8fPWIKY32eeQLkmatfawbI'\r\n            const client = new NFTStorage({token : apiKey})\r\n            const metadata = await client.store({\r\n                name: name.value,\r\n                description: description.value,\r\n                image: image_temp\r\n            })\r\n            const address = await web3.eth.getAccounts()\r\n\r\n            contract.methods.register_nft(route.params.departmentId, name.value, metadata.url).send({\r\n                from: address[0],\r\n                gas : 9187500,\r\n            }).then(() => {\r\n                contract.methods.addNFTToPlan(route.params.departmentId, selectedPlan.value, name.value).send({\r\n                    from: address[0],\r\n                    gas : 9187500,      \r\n                }).then(console.log)\r\n                .catch(console.log)\r\n            }).catch(err => {\r\n                console.log(\"error: \", err)\r\n            })\r\n        }\r\n\r\n\r\n        return {\r\n            name,\r\n            description,\r\n            image,\r\n            plans,\r\n            selectedPlan,\r\n            pickFile,\r\n            registerNFT\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.imagePreviewWrapper {\r\n  background-repeat: no-repeat;\r\n    width: 250px;\r\n    height: 250px;\r\n    display: block;\r\n    cursor: pointer;\r\n    margin: 0 auto 30px;\r\n    background-size: contain;\r\n    background-position: center center;\r\n}\r\n\r\n#nft-preview-img {\r\n    width: 80%;\r\n}\r\n</style>"],"sourceRoot":""}]}